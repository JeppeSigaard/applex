#!/usr/bin/env node
var BUILT_PRODUCTS_DIR=process.env.BUILT_PRODUCTS_DIR,FULL_PRODUCT_NAME=process.env.FULL_PRODUCT_NAME,COPY_HIDDEN=process.env.COPY_HIDDEN,PROJECT_FILE_PATH=process.env.PROJECT_FILE_PATH,path=require("path"),fs=require("fs"),shell=require("shelljs"),srcDir="www",dstDir=path.join(BUILT_PRODUCTS_DIR,FULL_PRODUCT_NAME),dstWwwDir=path.join(dstDir,"www");BUILT_PRODUCTS_DIR||(console.error("The script is meant to be run as an Xcode build step and relies on env variables set by Xcode."),process.exit(1));try{fs.statSync(srcDir)}catch(e){console.error("Path does not exist: "+srcDir),process.exit(2)}shell.rm("-rf",dstWwwDir),shell.rm("-rf",path.join(dstDir,"_CodeSignature")),shell.rm("-rf",path.join(dstDir,"PkgInfo")),shell.rm("-rf",path.join(dstDir,"embedded.mobileprovision"));var code;code=COPY_HIDDEN?shell.exec('rsync -Lra "'+srcDir+'" "'+dstDir+'"').code:shell.exec('rsync -Lra --exclude="- .*" "'+srcDir+'" "'+dstDir+'"').code,0!==code&&(console.error("Error occured on copying www. Code: "+code),process.exit(3)),shell.cp("-f",path.join(path.dirname(PROJECT_FILE_PATH),path.basename(PROJECT_FILE_PATH,".xcodeproj"),"config.xml"),dstDir);