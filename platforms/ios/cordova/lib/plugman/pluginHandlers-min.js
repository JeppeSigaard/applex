function installHelper(e,r,i,a,o,t,s){var n=path.resolve(i,r.src),l=path.resolve(s.plugins_dir,o,r.targetDir||""),p=path.join(l,path.basename(r.src)),f,d=!(!t||!t.link);if(d){var c=fs.realpathSync(n);t&&t.force?copyFile(i,c,a,p,d):copyNewFile(i,c,a,p,d),f="Plugins/"+fixPathSep(path.relative(fs.realpathSync(s.plugins_dir),c))}else t&&t.force?copyFile(i,n,a,p,d):copyNewFile(i,n,a,p,d),f="Plugins/"+fixPathSep(path.relative(s.plugins_dir,p));if("header-file"==e)s.xcode.addHeaderFile(f);else if(r.framework){var u={weak:r.weak},h=path.join(path.basename(s.xcode_path),f);s.xcode.addFramework(h,u),s.xcode.addToLibrarySearchPaths({path:f})}else s.xcode.addSourceFile(f,r.compilerFlags?{compilerFlags:r.compilerFlags}:{})}function uninstallHelper(e,r,i,a,o,t){var s=path.resolve(t.plugins_dir,a,r.targetDir||""),n=path.join(s,path.basename(r.src)),l,p=!(!o||!o.link);if(p){var f=fs.readlinkSync(n);l="Plugins/"+fixPathSep(path.relative(fs.realpathSync(t.plugins_dir),f))}else l="Plugins/"+fixPathSep(path.relative(t.plugins_dir,n));if(shell.rm("-rf",s),"header-file"==e)t.xcode.removeHeaderFile(l);else if(r.framework){var d=path.join(path.basename(t.xcode_path),l);t.xcode.removeFramework(d),t.xcode.removeFromLibrarySearchPaths({path:l})}else t.xcode.removeSourceFile(l)}function fixPathSep(e){return e.replace(pathSepFix,"/")}function copyFile(e,r,i,a,o){if(r=path.resolve(e,r),!fs.existsSync(r))throw new CordovaError('"'+r+'" not found!');var t=fs.realpathSync(r),s=fs.realpathSync(e);if(0!==t.indexOf(s))throw new CordovaError('File "'+r+'" is located outside the plugin directory "'+e+'"');if(a=path.resolve(i,a),0!==a.indexOf(i))throw new CordovaError('Destination "'+a+'" for source file "'+r+'" is located outside the project');shell.mkdir("-p",path.dirname(a)),o?symlinkFileOrDirTree(r,a):fs.statSync(r).isDirectory()?shell.cp("-Rf",path.join(r,"/*"),a):shell.cp("-f",r,a)}function copyNewFile(e,r,i,a,o){var t=path.resolve(i,a);if(fs.existsSync(t))throw new CordovaError('"'+t+'" already exists!');copyFile(e,r,i,a,!!o)}function symlinkFileOrDirTree(e,r){fs.existsSync(r)&&shell.rm("-Rf",r),fs.statSync(e).isDirectory()?(shell.mkdir("-p",r),fs.readdirSync(e).forEach(function(i){symlinkFileOrDirTree(path.join(e,i),path.join(r,i))})):fs.symlinkSync(path.relative(fs.realpathSync(path.dirname(r)),e),r)}function removeFile(e,r){var i=path.resolve(e,r);shell.rm("-Rf",i)}function removeFileF(e){shell.rm("-Rf",e)}function removeFileAndParents(e,r,i){i=i||".";var a=path.resolve(e,r);if(fs.existsSync(a)){removeFileF(a);for(var o=path.dirname(a);o!==path.resolve(e,i)&&fs.existsSync(o)&&0===fs.readdirSync(o).length;)fs.rmdirSync(o),o=path.resolve(o,"..")}}function generateAttributeError(e,r,i){return'Required attribute "'+e+'" not specified in <'+r+"> element from plugin: "+i}var fs=require("fs"),path=require("path"),shell=require("shelljs"),events=require("cordova-common").events,CordovaError=require("cordova-common").CordovaError,keep_these_frameworks=["MobileCoreServices.framework","CoreGraphics.framework","AssetsLibrary.framework"],handlers={"source-file":{install:function(e,r,i,a){installHelper("source-file",e,r.dir,i.projectDir,r.id,a,i)},uninstall:function(e,r,i,a){uninstallHelper("source-file",e,i.projectDir,r.id,a,i)}},"header-file":{install:function(e,r,i,a){installHelper("header-file",e,r.dir,i.projectDir,r.id,a,i)},uninstall:function(e,r,i,a){uninstallHelper("header-file",e,i.projectDir,r.id,a,i)}},"resource-file":{install:function(e,r,i,a){var o=e.src,t=path.resolve(r.dir,o),s=path.resolve(i.resources_dir,path.basename(o));if(!fs.existsSync(t))throw new CordovaError('Cannot find resource file "'+t+'" for plugin '+r.id+" in iOS platform");if(fs.existsSync(s))throw new CordovaError('File already exists at detination "'+s+'" for resource file specified by plugin '+r.id+" in iOS platform");i.xcode.addResourceFile(path.join("Resources",path.basename(o)));var n=!(!a||!a.link);copyFile(r.dir,o,i.projectDir,s,n)},uninstall:function(e,r,i,a){var o=e.src,t=path.resolve(i.resources_dir,path.basename(o));i.xcode.removeResourceFile(path.join("Resources",path.basename(o))),shell.rm("-rf",t)}},framework:{install:function(e,r,i,a){var o=e.src,t=e.custom;if(!t){var s=keep_these_frameworks;return void(s.indexOf(o)<0&&("podspec"===e.type||(i.frameworks[o]=i.frameworks[o]||0,i.frameworks[o]++,i.xcode.addFramework(o,{weak:e.weak}))))}var n=path.resolve(r.dir,o),l=path.resolve(i.plugins_dir,r.id,path.basename(o));if(!fs.existsSync(n))throw new CordovaError('Cannot find framework "'+n+'" for plugin '+r.id+" in iOS platform");if(fs.existsSync(l))throw new CordovaError('Framework "'+l+'" for plugin '+r.id+" already exists in iOS platform");var p=!(!a||!a.link);copyFile(r.dir,o,i.projectDir,l,p);var f=fixPathSep(path.relative(i.projectDir,l)),d=i.xcode.addFramework(f,{customFramework:!0});d&&i.xcode.addToPbxEmbedFrameworksBuildPhase(d)},uninstall:function(e,r,i,a){var o=e.src;if(e.custom){var t=fixPathSep(path.resolve(i.plugins_dir,r.id,path.basename(o))),s=i.xcode.removeFramework(t,{customFramework:!0});s&&i.xcode.removeFromPbxEmbedFrameworksBuildPhase(s),shell.rm("-rf",t)}else{var n=keep_these_frameworks;if(n.indexOf(o)<0)if("podspec"===e.type){var l=require(path.join(i.projectDir,"pods.json"));l[o]&&(l[o].count>1?l[o].count=l[o].count-1:delete l[o])}else i.frameworks[o]=i.frameworks[o]||1,i.frameworks[o]--,i.frameworks[o]<1&&(i.xcode.removeFramework(o),delete i.frameworks[o])}}},"lib-file":{install:function(e,r,i,a){events.emit("verbose","<lib-file> install is not supported for iOS plugins")},uninstall:function(e,r,i,a){events.emit("verbose","<lib-file> uninstall is not supported for iOS plugins")}},asset:{install:function(e,r,i,a){if(!e.src)throw new CordovaError(generateAttributeError("src","asset",r.id));if(!e.target)throw new CordovaError(generateAttributeError("target","asset",r.id));copyFile(r.dir,e.src,i.www,e.target),a&&a.usePlatformWww&&copyFile(r.dir,e.src,i.platformWww,e.target)},uninstall:function(e,r,i,a){var o=e.target;if(!o)throw new CordovaError(generateAttributeError("target","asset",r.id));removeFile(i.www,o),removeFileF(path.resolve(i.www,"plugins",r.id)),a&&a.usePlatformWww&&(removeFile(i.platformWww,o),removeFileF(path.resolve(i.platformWww,"plugins",r.id)))}},"js-module":{install:function(e,r,i,a){var o=path.resolve(r.dir,e.src),t=r.id+"."+(e.name||path.basename(e.src,path.extname(e.src))),s=fs.readFileSync(o,"utf-8").replace(/^\ufeff/,"");o.match(/.*\.json$/)&&(s="module.exports = "+s),s='cordova.define("'+t+'", function(require, exports, module) {\n'+s+"\n});\n";var n=path.resolve(i.www,"plugins",r.id,e.src);if(shell.mkdir("-p",path.dirname(n)),fs.writeFileSync(n,s,"utf-8"),a&&a.usePlatformWww){var l=path.resolve(i.platformWww,"plugins",r.id,e.src);shell.mkdir("-p",path.dirname(l)),fs.writeFileSync(l,s,"utf-8")}},uninstall:function(e,r,i,a){var o=path.join("plugins",r.id,e.src);removeFileAndParents(i.www,o),a&&a.usePlatformWww&&removeFileAndParents(i.platformWww,o)}}};module.exports.getInstaller=function(e){return handlers[e]&&handlers[e].install?handlers[e].install:void events.emit("warn","<"+e+"> is not supported for iOS plugins")},module.exports.getUninstaller=function(e){return handlers[e]&&handlers[e].uninstall?handlers[e].uninstall:void events.emit("warn","<"+e+"> is not supported for iOS plugins")};var pathSepFix=new RegExp(path.sep.replace(/\\/,"\\\\"),"g");